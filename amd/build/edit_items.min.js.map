{"version":3,"file":"edit_items.min.js","sources":["../src/edit_items.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD code for the frequently used comments chooser for the marking guide grading form.\n *\n * @module     mod_threesixo/edit_items\n * @class      edit_items\n * @copyright  2016 Jun Pataleta <jun@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport * as Templates from 'core/templates';\nimport * as Notification from 'core/notification';\nimport Ajax from 'core/ajax';\nimport * as Bank from 'mod_threesixo/question_bank';\nimport {eventTypes} from 'mod_threesixo/events';\nimport {add as addToast} from 'core/toast';\nimport {get_string as getString} from \"core/str\";\n\n/**\n * List of action selectors.\n *\n * @type {{DELETE: string, MOVE_UP: string, MOVE_DOWN: string}}\n */\nconst ACTIONS = {\n    DELETE: '[data-action=\"delete-item\"]',\n    MOVE_UP: '[data-action=\"move-item-up\"]',\n    MOVE_DOWN: '[data-action=\"move-item-down\"]'\n};\n\nexport default class EditItems {\n    threesixtyId;\n\n    constructor(threesixtyid) {\n        this.threesixtyId = threesixtyid;\n        this.registerEvents();\n    }\n\n    refreshItemList() {\n        const editItems = this;\n        const promises = Ajax.call([\n            {\n                methodname: 'mod_threesixo_get_items',\n                args: {\n                    threesixtyid: editItems.threesixtyId\n                }\n            }\n        ]);\n        $.when(promises[0]).then(function (response) {\n            const context = {\n                threesixtyid: editItems.threesixtyId\n            };\n\n            const items = [];\n            const itemCount = response.items.length;\n            $.each(response.items, function (key, value) {\n                const item = value;\n                item.deletebutton = true;\n                item.moveupbutton = false;\n                item.movedownbutton = false;\n                item.type = value.typetext;\n                if (itemCount > 1) {\n                    if (value.position === 1) {\n                        item.movedownbutton = true;\n                    } else if (value.position === itemCount) {\n                        item.moveupbutton = true;\n                    } else if (value.position > 1 && value.position < itemCount) {\n                        item.moveupbutton = true;\n                        item.movedownbutton = true;\n                    }\n                }\n                items.push(item);\n            });\n            context.allitems = items;\n\n            return Templates.render('mod_threesixo/list_360_items', context);\n\n        }).done(function (compiledSource, js) {\n            $('[data-region=\"itemlist\"]').replaceWith(compiledSource);\n            Templates.runTemplateJS(js);\n\n        }).fail(Notification.exception);\n    }\n\n    callItemAction(action, itemId) {\n        const editItems = this;\n        const promises = Ajax.call([\n            {\n                methodname: action,\n                args: {\n                    itemid: itemId\n                }\n            }\n        ]);\n        promises[0].then((response) => {\n            if (response.result) {\n                editItems.refreshItemList();\n                return getString('itemdeleted', 'mod_threesixo');\n            }\n            const warnings = response.warnings.join($('<br/>'));\n            throw new Error(warnings);\n        }).then((message) => {\n            return addToast(message, {});\n        }).catch(Notification.exception);\n    }\n\n    registerEvents() {\n        const editItems = this;\n\n        // Bind click event for the comments chooser button.\n        $(\"#btn-question-bank\").click(function (e) {\n            e.preventDefault();\n            Bank.init(editItems.threesixtyId);\n        });\n\n        $(ACTIONS.DELETE).click(function (e) {\n            e.preventDefault();\n\n            const itemId = $(this).data('itemid');\n            editItems.callItemAction('mod_threesixo_delete_item', itemId);\n        });\n\n        $(ACTIONS.MOVE_UP).click(function (e) {\n            e.preventDefault();\n\n            const itemId = $(this).data('itemid');\n            editItems.callItemAction('mod_threesixo_move_item_up', itemId);\n        });\n\n        $(ACTIONS.MOVE_DOWN).click(function (e) {\n            e.preventDefault();\n\n            const itemId = $(this).data('itemid');\n            editItems.callItemAction('mod_threesixo_move_item_down', itemId);\n        });\n\n        document.addEventListener(eventTypes.itemsUpdated, function() {\n            editItems.refreshItemList();\n        });\n    }\n}\n"],"names":["ACTIONS","constructor","threesixtyid","threesixtyId","registerEvents","refreshItemList","editItems","this","promises","Ajax","call","methodname","args","when","then","response","context","items","itemCount","length","each","key","value","item","deletebutton","moveupbutton","movedownbutton","type","typetext","position","push","allitems","Templates","render","done","compiledSource","js","replaceWith","runTemplateJS","fail","Notification","exception","callItemAction","action","itemId","itemid","result","warnings","join","Error","message","catch","click","e","preventDefault","Bank","init","data","document","addEventListener","eventTypes","itemsUpdated"],"mappings":"qjDAqCMA,eACM,8BADNA,gBAEO,+BAFPA,kBAGS,+DAMXC,YAAYC,yLACHC,aAAeD,kBACfE,iBAGTC,wBACUC,UAAYC,KACZC,SAAWC,cAAKC,KAAK,CACvB,CACIC,WAAY,0BACZC,KAAM,CACFV,aAAcI,UAAUH,iCAIlCU,KAAKL,SAAS,IAAIM,MAAK,SAAUC,gBACzBC,QAAU,CACZd,aAAcI,UAAUH,cAGtBc,MAAQ,GACRC,UAAYH,SAASE,MAAME,8BAC/BC,KAAKL,SAASE,OAAO,SAAUI,IAAKC,aAC5BC,KAAOD,MACbC,KAAKC,cAAe,EACpBD,KAAKE,cAAe,EACpBF,KAAKG,gBAAiB,EACtBH,KAAKI,KAAOL,MAAMM,SACdV,UAAY,IACW,IAAnBI,MAAMO,SACNN,KAAKG,gBAAiB,EACfJ,MAAMO,WAAaX,UAC1BK,KAAKE,cAAe,EACbH,MAAMO,SAAW,GAAKP,MAAMO,SAAWX,YAC9CK,KAAKE,cAAe,EACpBF,KAAKG,gBAAiB,IAG9BT,MAAMa,KAAKP,SAEfP,QAAQe,SAAWd,MAEZe,UAAUC,OAAO,+BAAgCjB,YAEzDkB,MAAK,SAAUC,eAAgBC,wBAC5B,4BAA4BC,YAAYF,gBAC1CH,UAAUM,cAAcF,OAEzBG,KAAKC,aAAaC,WAGzBC,eAAeC,OAAQC,cACbtC,UAAYC,KACDE,cAAKC,KAAK,CACvB,CACIC,WAAYgC,OACZ/B,KAAM,CACFiC,OAAQD,WAIX,GAAG9B,MAAMC,cACVA,SAAS+B,cACTxC,UAAUD,mBACH,mBAAU,cAAe,uBAE9B0C,SAAWhC,SAASgC,SAASC,MAAK,mBAAE,gBACpC,IAAIC,MAAMF,aACjBjC,MAAMoC,UACE,cAASA,QAAS,MAC1BC,MAAMX,aAAaC,WAG1BrC,uBACUE,UAAYC,yBAGhB,sBAAsB6C,OAAM,SAAUC,GACpCA,EAAEC,iBACFC,KAAKC,KAAKlD,UAAUH,qCAGtBH,gBAAgBoD,OAAM,SAAUC,GAC9BA,EAAEC,uBAEIV,QAAS,mBAAErC,MAAMkD,KAAK,UAC5BnD,UAAUoC,eAAe,4BAA6BE,+BAGxD5C,iBAAiBoD,OAAM,SAAUC,GAC/BA,EAAEC,uBAEIV,QAAS,mBAAErC,MAAMkD,KAAK,UAC5BnD,UAAUoC,eAAe,6BAA8BE,+BAGzD5C,mBAAmBoD,OAAM,SAAUC,GACjCA,EAAEC,uBAEIV,QAAS,mBAAErC,MAAMkD,KAAK,UAC5BnD,UAAUoC,eAAe,+BAAgCE,WAG7Dc,SAASC,iBAAiBC,mBAAWC,cAAc,WAC/CvD,UAAUD"}