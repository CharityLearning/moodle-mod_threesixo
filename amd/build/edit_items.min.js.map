{"version":3,"file":"edit_items.min.js","sources":["../src/edit_items.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD code for the frequently used comments chooser for the marking guide grading form.\n *\n * @module     mod_threesixo/edit_items\n * @class      edit_items\n * @copyright  2016 Jun Pataleta <jun@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification',\n    'core/ajax',\n    'core/str',\n    'mod_threesixo/question_bank',\n    'core/yui'\n], function($, Templates, Notification, Ajax, Str, Bank) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{DELETE: string, MOVE_UP: string, MOVE_DOWN: string}}\n     */\n    var ACTIONS = {\n        DELETE: '[data-action=\"delete-item\"]',\n        MOVE_UP: '[data-action=\"move-item-up\"]',\n        MOVE_DOWN: '[data-action=\"move-item-down\"]'\n    };\n\n    var threesixtyId;\n    var editItems = function(threesixtyid) {\n        threesixtyId = threesixtyid;\n        this.registerEvents();\n    };\n\n    editItems.refreshItemList = function() {\n        var promises = Ajax.call([\n            {\n                methodname: 'mod_threesixo_get_items',\n                args: {\n                    threesixtyid: threesixtyId\n                }\n            }\n        ]);\n        $.when(promises[0]).then(function(response) {\n            var context = {\n                threesixtyid: threesixtyId\n            };\n\n            var items = [];\n            var itemCount = response.items.length;\n            $.each(response.items, function(key, value) {\n                var item = value;\n                item.deletebutton = true;\n                item.moveupbutton = false;\n                item.movedownbutton = false;\n                item.type = value.typetext;\n                if (itemCount > 1) {\n                    if (value.position === 1) {\n                        item.movedownbutton = true;\n                    } else if (value.position === itemCount) {\n                        item.moveupbutton = true;\n                    } else if (value.position > 1 && value.position < itemCount) {\n                        item.moveupbutton = true;\n                        item.movedownbutton = true;\n                    }\n                }\n                items.push(item);\n            });\n            context.allitems = items;\n\n            return Templates.render('mod_threesixo/list_360_items', context);\n\n        }).done(function(compiledSource, js) {\n            $('[data-region=\"itemlist\"]').replaceWith(compiledSource);\n            Templates.runTemplateJS(js);\n\n        }).fail(Notification.exception);\n    };\n\n    editItems.callItemAction = function(action, itemId) {\n        var promises = Ajax.call([\n            {\n                methodname: action,\n                args: {\n                    itemid: itemId\n                }\n            }\n        ]);\n        promises[0].done(function(response) {\n            if (response.result) {\n                editItems.refreshItemList();\n                return true;\n            }\n            var warnings = response.warnings.join($('<br/>'));\n            throw new Error(warnings);\n        }).fail(Notification.exception);\n    };\n\n    editItems.prototype.registerEvents = function() {\n        // Bind click event for the comments chooser button.\n        $(\"#btn-question-bank\").click(function(e) {\n            e.preventDefault();\n            Bank.init(threesixtyId);\n        });\n\n        $(ACTIONS.DELETE).click(function(e) {\n            e.preventDefault();\n\n            var itemId = $(this).data('itemid');\n            editItems.callItemAction('mod_threesixo_delete_item', itemId);\n        });\n\n        $(ACTIONS.MOVE_UP).click(function(e) {\n            e.preventDefault();\n\n            var itemId = $(this).data('itemid');\n            editItems.callItemAction('mod_threesixo_move_item_up', itemId);\n        });\n\n        $(ACTIONS.MOVE_DOWN).click(function(e) {\n            e.preventDefault();\n\n            var itemId = $(this).data('itemid');\n            editItems.callItemAction('mod_threesixo_move_item_down', itemId);\n        });\n    };\n\n    return editItems;\n});\n"],"names":["define","$","Templates","Notification","Ajax","Str","Bank","threesixtyId","ACTIONS","editItems","threesixtyid","registerEvents","refreshItemList","promises","call","methodname","args","when","then","response","context","items","itemCount","length","each","key","value","item","deletebutton","moveupbutton","movedownbutton","type","typetext","position","push","allitems","render","done","compiledSource","js","replaceWith","runTemplateJS","fail","exception","callItemAction","action","itemId","itemid","result","warnings","join","Error","prototype","click","e","preventDefault","init","this","data"],"mappings":";;;;;;;;AAuBAA,kCAAO,CACH,SACA,iBACA,oBACA,YACA,WACA,8BACA,aACD,SAASC,EAAGC,UAAWC,aAAcC,KAAMC,IAAKC,UAa3CC,aANAC,eACQ,8BADRA,gBAES,+BAFTA,kBAGW,iCAIXC,UAAY,SAASC,cACrBH,aAAeG,kBACVC,yBAGTF,UAAUG,gBAAkB,eACpBC,SAAWT,KAAKU,KAAK,CACrB,CACIC,WAAY,0BACZC,KAAM,CACFN,aAAcH,iBAI1BN,EAAEgB,KAAKJ,SAAS,IAAIK,MAAK,SAASC,cAC1BC,QAAU,CACVV,aAAcH,cAGdc,MAAQ,GACRC,UAAYH,SAASE,MAAME,cAC/BtB,EAAEuB,KAAKL,SAASE,OAAO,SAASI,IAAKC,WAC7BC,KAAOD,MACXC,KAAKC,cAAe,EACpBD,KAAKE,cAAe,EACpBF,KAAKG,gBAAiB,EACtBH,KAAKI,KAAOL,MAAMM,SACdV,UAAY,IACW,IAAnBI,MAAMO,SACNN,KAAKG,gBAAiB,EACfJ,MAAMO,WAAaX,UAC1BK,KAAKE,cAAe,EACbH,MAAMO,SAAW,GAAKP,MAAMO,SAAWX,YAC9CK,KAAKE,cAAe,EACpBF,KAAKG,gBAAiB,IAG9BT,MAAMa,KAAKP,SAEfP,QAAQe,SAAWd,MAEZnB,UAAUkC,OAAO,+BAAgChB,YAEzDiB,MAAK,SAASC,eAAgBC,IAC7BtC,EAAE,4BAA4BuC,YAAYF,gBAC1CpC,UAAUuC,cAAcF,OAEzBG,KAAKvC,aAAawC,YAGzBlC,UAAUmC,eAAiB,SAASC,OAAQC,QACzB1C,KAAKU,KAAK,CACrB,CACIC,WAAY8B,OACZ7B,KAAM,CACF+B,OAAQD,WAIX,GAAGT,MAAK,SAASlB,aAClBA,SAAS6B,cACTvC,UAAUG,mBACH,MAEPqC,SAAW9B,SAAS8B,SAASC,KAAKjD,EAAE,gBAClC,IAAIkD,MAAMF,aACjBP,KAAKvC,aAAawC,YAGzBlC,UAAU2C,UAAUzC,eAAiB,WAEjCV,EAAE,sBAAsBoD,OAAM,SAASC,GACnCA,EAAEC,iBACFjD,KAAKkD,KAAKjD,iBAGdN,EAAEO,gBAAgB6C,OAAM,SAASC,GAC7BA,EAAEC,qBAEET,OAAS7C,EAAEwD,MAAMC,KAAK,UAC1BjD,UAAUmC,eAAe,4BAA6BE,WAG1D7C,EAAEO,iBAAiB6C,OAAM,SAASC,GAC9BA,EAAEC,qBAEET,OAAS7C,EAAEwD,MAAMC,KAAK,UAC1BjD,UAAUmC,eAAe,6BAA8BE,WAG3D7C,EAAEO,mBAAmB6C,OAAM,SAASC,GAChCA,EAAEC,qBAEET,OAAS7C,EAAEwD,MAAMC,KAAK,UAC1BjD,UAAUmC,eAAe,+BAAgCE,YAI1DrC"}