define ("mod_threesixo/edit_items",["jquery","core/templates","core/notification","core/ajax","core/str","mod_threesixo/question_bank"],function(a,b,c,d,e,f){var g={DELETE:"[data-action=\"delete-item\"]",MOVE_UP:"[data-action=\"move-item-up\"]",MOVE_DOWN:"[data-action=\"move-item-down\"]"},h={ITEM_LIST:"[data-region=\"itemlist\"]",ITEM_ROW:"[data-region=\"itemrow\"]"},i,j=function(a){i=a;this.registerEvents()};j.refreshItemList=function(){var e=d.call([{methodname:"mod_threesixo_get_items",args:{threesixtyid:i}}]);a.when(e[0]).then(function(c){var d={threesixtyid:i},e=[],f=c.items.length;a.each(c.items,function(a,b){var c=b;c.deletebutton=!0;c.moveupbutton=!1;c.movedownbutton=!1;c.type=b.typetext;if(1<f){c.position=b.position;if(1===b.position){c.movedownbutton=!0}else if(b.position===f){c.moveupbutton=!0}else if(1<b.position&&b.position<f){c.moveupbutton=!0;c.movedownbutton=!0}}e.push(c)});d.allitems=e;return b.render("mod_threesixo/list_360_items",d)}).done(function(c,d){a("[data-region=\"itemlist\"]").replaceWith(c);b.runTemplateJS(d)}).fail(c.exception)};j.callItemAction=function(b,e){var f=d.call([{methodname:b,args:{itemid:e}}]);f[0].done(function(b){if(b.result){j.refreshItemList();return!0}var c=b.warnings.join(a("<br/>"));throw new Error(c)}).fail(c.exception)};j.prototype.registerEvents=function(){a("#btn-question-bank").click(function(a){a.preventDefault();f.init(i)});a(g.DELETE).click(function(b){b.preventDefault();var c=a(this).data("itemid");j.callItemAction("mod_threesixo_delete_item",c)});a(g.MOVE_UP).click(function(b){b.preventDefault();var c=a(this).data("itemid");j.callItemAction("mod_threesixo_move_item_up",c)});a(g.MOVE_DOWN).click(function(b){b.preventDefault();var c=a(this).data("itemid");j.callItemAction("mod_threesixo_move_item_down",c)});var b=document.querySelector(h.ITEM_LIST),c=b.querySelectorAll(h.ITEM_ROW);c.forEach(function(a){a.addEventListener("dragstart",l,!1);a.addEventListener("dragover",n,!1);a.addEventListener("drop",m,!1)})};var k=null,l=function(a){k=a.target;a.dataTransfer.effectAllowed="move";a.dataTransfer.setData("text/html",k.outerHTML)},m=function(a){if(a.stopPropagation){a.stopPropagation()}var b=a.target.closest(h.ITEM_ROW);if(k!==void 0&&k!==b){var c=k.getAttribute("data-itemid"),d=parseInt(k.getAttribute("data-position")),e=parseInt(b.getAttribute("data-position")),f="beforebegin";if(d<e){f="afterend"}k.parentNode.removeChild(k);var g=document.createElement("template");g.innerHTML=a.dataTransfer.getData("text/html").trim();var i=g.content.firstChild;i.setAttribute("data-position",e);b.insertAdjacentElement(f,i);var j=b.parentNode.querySelectorAll(h.ITEM_ROW);j.forEach(function(a){var b=a.getAttribute("data-itemid"),d=parseInt(a.getAttribute("data-position"));if(b!==c){if("beforebegin"===f&&d>=e){a.setAttribute("data-position",d+1)}else if("afterend"===f&&d<=e){a.setAttribute("data-position",d-1)}}})}return!1},n=function(a){if(a.preventDefault){a.preventDefault()}a.dataTransfer.dropEffect="move";return!1};return j});
//# sourceMappingURL=edit_items.min.js.map
