define("mod_threesixo/edit_items",["exports","jquery","core/templates","core/notification","core/ajax","mod_threesixo/question_bank","mod_threesixo/events","core/toast","core/str"],(function(_exports,_jquery,Templates,Notification,_ajax,Bank,_events,_toast,_str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),Templates=_interopRequireWildcard(Templates),Notification=_interopRequireWildcard(Notification),_ajax=_interopRequireDefault(_ajax),Bank=_interopRequireWildcard(Bank);const ACTIONS_DELETE='[data-action="delete-item"]',ACTIONS_MOVE_UP='[data-action="move-item-up"]',ACTIONS_MOVE_DOWN='[data-action="move-item-down"]';return _exports.default=class{constructor(threesixtyid){var obj,key,value;value=void 0,(key="threesixtyId")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.threesixtyId=threesixtyid,this.registerEvents()}refreshItemList(){const editItems=this,promises=_ajax.default.call([{methodname:"mod_threesixo_get_items",args:{threesixtyid:editItems.threesixtyId}}]);_jquery.default.when(promises[0]).then((function(response){const context={threesixtyid:editItems.threesixtyId},items=[],itemCount=response.items.length;return _jquery.default.each(response.items,(function(key,value){const item=value;item.deletebutton=!0,item.moveupbutton=!1,item.movedownbutton=!1,item.type=value.typetext,itemCount>1&&(1===value.position?item.movedownbutton=!0:value.position===itemCount?item.moveupbutton=!0:value.position>1&&value.position<itemCount&&(item.moveupbutton=!0,item.movedownbutton=!0)),items.push(item)})),context.allitems=items,Templates.render("mod_threesixo/list_360_items",context)})).done((function(compiledSource,js){(0,_jquery.default)('[data-region="itemlist"]').replaceWith(compiledSource),Templates.runTemplateJS(js)})).fail(Notification.exception)}callItemAction(action,itemId){const editItems=this;_ajax.default.call([{methodname:action,args:{itemid:itemId}}])[0].then((response=>{if(response.result)return editItems.refreshItemList(),(0,_str.get_string)("itemdeleted","mod_threesixo");const warnings=response.warnings.join((0,_jquery.default)("<br/>"));throw new Error(warnings)})).then((message=>(0,_toast.add)(message,{}))).catch(Notification.exception)}registerEvents(){const editItems=this;(0,_jquery.default)("#btn-question-bank").click((function(e){e.preventDefault(),Bank.init(editItems.threesixtyId)})),(0,_jquery.default)(ACTIONS_DELETE).click((function(e){e.preventDefault();const itemId=(0,_jquery.default)(this).data("itemid");editItems.callItemAction("mod_threesixo_delete_item",itemId)})),(0,_jquery.default)(ACTIONS_MOVE_UP).click((function(e){e.preventDefault();const itemId=(0,_jquery.default)(this).data("itemid");editItems.callItemAction("mod_threesixo_move_item_up",itemId)})),(0,_jquery.default)(ACTIONS_MOVE_DOWN).click((function(e){e.preventDefault();const itemId=(0,_jquery.default)(this).data("itemid");editItems.callItemAction("mod_threesixo_move_item_down",itemId)})),document.addEventListener(_events.eventTypes.itemsUpdated,(function(){editItems.refreshItemList()}))}},_exports.default}));

//# sourceMappingURL=edit_items.min.js.map