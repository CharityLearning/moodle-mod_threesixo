/**
 * AMD code for the frequently used comments chooser for the marking guide grading form.
 *
 * @module     mod_threesixo/edit_items
 * @class      edit_items
 * @copyright  2016 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_threesixo/edit_items",["jquery","core/templates","core/notification","core/ajax","core/str","mod_threesixo/question_bank","core/yui"],(function($,Templates,Notification,Ajax,Str,Bank){var threesixtyId,ACTIONS_DELETE='[data-action="delete-item"]',ACTIONS_MOVE_UP='[data-action="move-item-up"]',ACTIONS_MOVE_DOWN='[data-action="move-item-down"]',editItems=function(threesixtyid){threesixtyId=threesixtyid,this.registerEvents()};return editItems.refreshItemList=function(){var promises=Ajax.call([{methodname:"mod_threesixo_get_items",args:{threesixtyid:threesixtyId}}]);$.when(promises[0]).then((function(response){var context={threesixtyid:threesixtyId},items=[],itemCount=response.items.length;return $.each(response.items,(function(key,value){var item=value;item.deletebutton=!0,item.moveupbutton=!1,item.movedownbutton=!1,item.type=value.typetext,itemCount>1&&(1===value.position?item.movedownbutton=!0:value.position===itemCount?item.moveupbutton=!0:value.position>1&&value.position<itemCount&&(item.moveupbutton=!0,item.movedownbutton=!0)),items.push(item)})),context.allitems=items,Templates.render("mod_threesixo/list_360_items",context)})).done((function(compiledSource,js){$('[data-region="itemlist"]').replaceWith(compiledSource),Templates.runTemplateJS(js)})).fail(Notification.exception)},editItems.callItemAction=function(action,itemId){Ajax.call([{methodname:action,args:{itemid:itemId}}])[0].done((function(response){if(response.result)return editItems.refreshItemList(),!0;var warnings=response.warnings.join($("<br/>"));throw new Error(warnings)})).fail(Notification.exception)},editItems.prototype.registerEvents=function(){$("#btn-question-bank").click((function(e){e.preventDefault(),Bank.init(threesixtyId)})),$(ACTIONS_DELETE).click((function(e){e.preventDefault();var itemId=$(this).data("itemid");editItems.callItemAction("mod_threesixo_delete_item",itemId)})),$(ACTIONS_MOVE_UP).click((function(e){e.preventDefault();var itemId=$(this).data("itemid");editItems.callItemAction("mod_threesixo_move_item_up",itemId)})),$(ACTIONS_MOVE_DOWN).click((function(e){e.preventDefault();var itemId=$(this).data("itemid");editItems.callItemAction("mod_threesixo_move_item_down",itemId)}))},editItems}));

//# sourceMappingURL=edit_items.min.js.map